<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>博客后台管理</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/common.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <script type="text/javascript" src="/assets/js/libs/modernizr.min.js"></script>
</head>

<body>
    <div class="topbar-wrap white">
        <div class="topbar-inner clearfix">
            <div class="topbar-logo-wrap clearfix">
                <h1 class="topbar-logo none"><a href="index.html" class="navbar-brand">后台管理</a></h1>
                <ul class="navbar-list clearfix">
                    <li><a class="on" href="/users">首页</a></li>
                    <li><a href="#" target="_blank">网站首页</a></li>
                </ul>
            </div>
            <div class="top-info-wrap">
                <ul class="top-info-list clearfix">
                    <li>
                        <a href="/login">
                            <%=admin.username%>
                        </a>
                    </li>
                    <li><a href="http://www.mycodes.net">修改密码</a></li>
                    <li><a href="/logout">退出</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container clearfix">
        <div class="sidebar-wrap">
            <div class="sidebar-title">
                <h1>菜单</h1>
            </div>
            <div class="sidebar-content">
                <ul class="sidebar-list">
                    <li>
                        <a href="#"><i class="icon-font">&#xe003;</i>网站管理</a>
                        <ul class="sub-menu">
                            <li><a href="/users"><i class="icon-font">&#xe008;</i>用户管理</a></li>
                            <li><a href="/types"><i class="icon-font">&#xe005;</i>分类管理</a></li>
                            <li><a href="/articles"><i class="icon-font">&#xe006;</i>文章管理</a></li>
                            <!-- <li><a href="design.html"><i class="icon-font">&#xe004;</i>留言管理</a></li>
                            <li><a href="design.html"><i class="icon-font">&#xe012;</i>评论管理</a></li>
                            <li><a href="design.html"><i class="icon-font">&#xe052;</i>友情链接</a></li>
                            <li><a href="design.html"><i class="icon-font">&#xe033;</i>广告管理</a></li> -->
                        </ul>
                    </li>
                    <!-- <li>
                        <a href="#"><i class="icon-font">&#xe018;</i>系统管理</a>
                        <ul class="sub-menu">
                            <li><a href="system.html"><i class="icon-font">&#xe017;</i>系统设置</a></li>
                            <li><a href="system.html"><i class="icon-font">&#xe037;</i>清理缓存</a></li>
                            <li><a href="system.html"><i class="icon-font">&#xe046;</i>数据备份</a></li>
                            <li><a href="system.html"><i class="icon-font">&#xe045;</i>数据还原</a></li>
                        </ul>
                    </li> -->
                </ul>
            </div>
        </div>
        <!--/sidebar-->
        <div class="main-wrap">
            <div class="crumb-wrap">
                <div class="crumb-list"><i class="icon-font"></i><a href="index.html">首页</a><span class="crumb-step">&gt;</span><span class="crumb-name">用户管理</span></div>
                <div class="search-wrap">
                    <div class="search-content">
                        <form action="#" method="post">
                            <table class="search-tab">
                                <tr>
                                    <th width="120">选择分类:</th>
                                    <td>
                                        <select name="search-sort" id="">
                                            <option value="">全部</option>
                                            <option value="19">精品界面</option>
                                            <option value="20">推荐界面</option>
                                        </select>
                                    </td>
                                    <th width="70">关键字:</th>
                                    <td>
                                        <input class="common-text" placeholder="关键字" name="keywords" value="" id="" type="text">
                                    </td>
                                    <td>
                                        <input class="btn btn-primary btn2" name="sub" value="查询" type="submit">
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
                <div class="result-wrap">
                    <form name="myform" id="myform" method="post">
                        <div class="result-title">
                            <div class="result-list">
                                <a href="/users/insert"><i class="icon-font"></i>新增用户1</a>
                                <a href="" class="insert"><i class="icon-font"></i>新增用户2</a>
                                <a id="batchDel" href="javascript:void(0)"><i class="icon-font"></i>批量删除</a>
                                <a id="updateOrd" href="javascript:void(0)"><i class="icon-font"></i>更新排序</a>
                            </div>
                        </div>
                        <div class="result-content">
                            <table class="result-tab" width="100%">
                                <tr>
                                    <th class="tc" width="5%">
                                        <input class="allChoose" name="" type="checkbox">
                                    </th>
                                    <th>编号</th>
                                    <th>姓名</th>
                                    <th>头像</th>
                                    <th>年龄</th>
                                    <th>性别</th>
                                    <th>手机号码</th>
                                    <th>注册时间</th>
                                    <th>操作</th>
                                </tr>
                                <!-- 后端的JS代码 -->
                                <% results.forEach(function(value,key){ %>
                                    <tr>
                                        <td class="tc">
                                            <input name="id[]" value="59" type="checkbox">
                                        </td>
                                        <td>
                                            <%=value.id%>
                                        </td>
                                        <td>
                                            <%=value.username%>
                                        </td>
                                        <td><img src="/upload/<%=value.photo%>" width="50" alt=""></td>
                                        <td>
                                            <%=value.age%>
                                        </td>
                                        <td>
                                            <%=value.sex == 1 ? '男' : '女'%>
                                        </td>
                                        <td>
                                            <%=value.phone%>
                                        </td>
                                        <td>
                                            <%=moment.unix(value.addtime).format('YYYY-MM-DD HH:mm:ss')%>
                                        </td>
                                        <td>
                                            <a href="/users/update/<%=value.id%>">修改</a>
                                            <a href="/users/delete/<%=value.id%>">删除</a>
                                            <a href="" class="del" data-id="<%=value.id%>">ajax删除</a>
                                           <!--  <a href="" class="up" data-id="<%=value.id%>">ajax修改</a> -->
                                            <a href="/users/image/<%=value.id%>">添加头像</a>
                                        </td>
                                    </tr>
                                    <% }) %>
                                        <tr>
                                            <td colspan="9">
                                                <a href="/users?p=1">首页</a>
                                                <a href="/users?p=<%=page.prev%>">上一页</a>
                                                <% for (var i = 1; i <= page.pages; i++) { %>
                                                    <!-- 当到4-22页的时候，展示的是。。。 -->
                                                    <% if (i >= page.now+2 && i < page.pages) { %>
                                                        <% continue; %>
                                                            <% } %>
                                                                <a href="/users?p=<%=i%>">第<%=i%>页</a>
                                                                <% } %>
                                                                    <a href="/users?p=<%=page.next%>">下一页</a>
                                                                    <a href="/users?p=<%=page.pages%>">末页</a>
                                            </td>
                                        </tr>
                            </table>
                        </div>
                    </form>
                </div>
            </div>
            <!--/main-->
        </div>
        <div id="addusers" style="display: none;">
                <form action="" method="">
                    用户名：<input class="username" type="text" name="username" value=""><br><br>
                    密码：<input class="password" type="password" name="password">
                </form>
        </div>
    <script src="/plugins/jquery/dist/jquery.min.js"></script>
    <script src="/plugins/artdialog/dialog.js"></script>
    <script>
    $(function(){
        /*
            当点击按钮的时候，页面不能跳转，通过ajax请求将要删除数据的id传送到服务器，服务器接收并进行删除，返回删除的结果(失败/成功),失败了告诉用户失败，成功了，通过js的DOM操作，将当前行删除
        */
        // 1.点击按钮
        $('.del').click(function(e){
            // 2. 页面不能跳转
            e.preventDefault();

            // 将that赋值当前对象引入到ajax的回调函数中
            var that = $(this);

            // console.log($(this).attr('data-id'));
            // 3.通过ajax将数据id发送到服务器
            $.post('/users/adelete',{id:$(this).attr('data-id')},function(data){
                // console.log(data);
                if (data.success === 1) {
                    // 删除成功-通过js的DOM操作，将当前行删除
                    that.parents('tr').remove();
                } else {
                    // 删除失败
                    alert('删除失败');
                }
            })
        })

        $('.insert').click(function(e){
            e.preventDefault();

            dialog({
                title: '欢迎',
                content: $('#addusers'),
                okValue: '确认',
                ok: function(){
                    // 将表单中的数据 获取到，然后通过ajax发送到服务器，服务器 进行添加数据，并返回结果，告诉我们成功与否

                    // 获取表单数据
                    var username = $('.username').val();
                    var password = $('.password').val();
                    
                    $.post('/users/ainsert',{username:username,password:password},function(data){
                        if (data.success === 1) {
                            // 刷新当前页面
                            location.reload();

                            // 当添加数据成功之后，后台给我们返回添加的数据，然后我们在前端将数据和标签进行拼接，拼接完成在追加到表格中
                        } else {
                            // 弹出失败
                            alert('添加失败');
                        }
                    })
                }
            }).show();
        })
        // $('.up').click(function(e){
        //     e.preventDefault();
        //     dialog({
        //         title:'欢迎',
        //         content:$('#upusers'),
        //         okValue:'确认',
        //         ok:function(){
        //             var username=$('.username').val();
        //             var password=$('.password').val();
        //             $.post('/users/aup',{username:username,password:password},function(data){
        //                 if (data.success === 1) {
        //                     // 刷新当前页面
        //                     location.reload();

        //                     // 当添加数据成功之后，后台给我们返回添加的数据，然后我们在前端将数据和标签进行拼接，拼接完成在追加到表格中
        //                 } else {
        //                     // 弹出失败
        //                     alert('修改失败');
        //                 }
        //             })
        //         }
        //     })
        // })
    })
    </script>        
</body>

</html>